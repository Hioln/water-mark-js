{"version":3,"sources":["index.js"],"names":["WaterMark","option","hasMark","id","fontSize","fontFamily","color","rotate","userName","getUserName","handleCreateListener","hackPrint","cookie","arr","document","split","ret","undefined","forEach","item","replace","indexOf","ele","querySelector","createElement","canvas","getContext","width","height","font","fillStyle","globalAlpha","translate","Math","floor","PI","fillText","handleCreateCanvas","toDataURL","handleCheckDom","url","handleCreateBgUrl","waterMarkDom","styleOption","waterMarkStyle","style","body","appendChild","mutation","window","MutationObserver","WebkitMutationObserver","MozMutationObserver","listener","disconnect","handleCreateDom","observe","attributes","childList","subtree","addEventListener","type","innerHTML","head"],"mappings":"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","file":"index.js","sourceRoot":"../src","sourcesContent":["class WaterMark {\n  constructor(option) {\n    this.hasMark = false;\n    this.option = {\n      ...option,\n      id: 'waterMark',\n      fontSize: 14,\n      fontFamily: 'Arial',\n      color: '#959494',\n      rotate: 30,\n      userName: this.getUserName(),\n    };\n    this.handleCreateListener();\n    this.hackPrint();\n  }\n\n  /**\n   * 获取用户名信息\n   */\n  getUserName() {\n    const cookie = document.cookie;\n    const arr = cookie.split(';');\n    let ret = undefined;\n    arr.forEach(item => {\n      const index = item.replace(' ', '').indexOf('user_name');\n      if (index !== -1) {\n        ret = item.replace(' ', '').replace('user_name=', '');\n      }\n    });\n    return ret || 'noCookie';\n  }\n\n  /**\n   * 检查当前水印DOM节点是否存在\n   */\n  handleCheckDom() {\n    const {\n      id,\n    } = this.option;\n    const ele = document.querySelector(id);\n    return ele;\n  }\n\n  /**\n   * 生成带用户名的 Canvas\n   */\n  handleCreateCanvas() {\n    const {\n      color,\n      fontSize,\n      fontFamily,\n      rotate,\n      userName\n    } = this.option;\n    const ele = document.createElement('canvas');\n    const canvas = ele.getContext('2d');\n    const width = 100;\n    const height = 100;\n    const alpha = 0.65;\n    ele.width = width;\n    ele.height = height;\n    canvas.font = `${fontSize}px ${fontFamily}`;\n    canvas.fillStyle = color;\n    canvas.globalAlpha = alpha;\n    canvas.translate(-Math.floor(width / 2), Math.floor(height / 2));\n    canvas.rotate((-rotate / 180) * Math.PI);\n    canvas.fillText(userName, Math.floor(width / 2), Math.floor(height / 2));\n    return ele;\n  }\n\n  /**\n   * 转换成 base64 格式的图片\n   */\n  handleCreateBgUrl() {\n    return this.handleCreateCanvas().toDataURL();\n  }\n\n  /**\n   * Dom书中添加水印节点\n   */\n  handleCreateDom() {\n    const flag = this.handleCheckDom();\n    if (!flag) {\n      const url = this.handleCreateBgUrl();\n      const waterMarkDom = document.createElement('div');\n      const styleOption = `\n        position: fixed;\n        left: 0;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        z-index: 999;\n        pointerEvents: none;\n        background-repeat: repeat;\n        background-image: url('${url}');\n      `;\n      this.waterMarkStyle = styleOption;\n      waterMarkDom.style = styleOption;\n      waterMarkDom.id = this.option.id;\n      document.body.appendChild(waterMarkDom);\n    }\n  }\n\n  /**\n   * 监听Dom树的变化\n   */\n  handleObserverDom() {\n    const mutation = window.MutationObserver || window.WebkitMutationObserver || window.MozMutationObserver;\n    const config = {\n      attributes: true,\n      childList: true,\n      subtree: true,\n    };\n    if (mutation) {\n      let listener = new MutationObserver(() => {\n        const ele = document.querySelector(this.option.id);\n        if (!ele || (ele && ele.style !== this.waterMarkStyle)) {\n          listener.disconnect();\n          listener = null;\n          this.handleCreateDom();\n        }\n      });\n      listener.observe(document.body, config);\n    }\n  }\n\n  /**\n   * 添加 listener 待插入水印节点\n   */\n  handleCreateListener() {\n    document.addEventListener('DOMContentLoaded', () => {\n      this.handleCreateDom();\n    });\n    window.addEventListener('hashChange', () => {\n      this.handleCreateDom();\n    });\n  }\n\n  /**\n   * 针对浏览器预览打印时会遮住打印文档的问题做hack\n   */\n  hackPrint() {\n    const ele = document.createElement('style');\n    ele.type = 'text/css';\n    ele.innerHTML = '@media print{ #waterMark : { display: none }}';\n    document.head.appendChild(ele);\n  }\n}\n\nexport default WaterMark;"]}